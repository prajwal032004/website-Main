{% extends "admin/base.html" %} {% block title %}Manage Blog{% endblock %} {%
block content %}
<div class="page-header d-flex justify-content-between align-items-center">
  <div>
    <h1><i class="fas fa-blog"></i> Manage Blog Posts</h1>
    <p class="text-muted">Create and manage blog content</p>
  </div>
  <a href="{{ url_for('admin_edit_blog') }}" class="btn btn-primary">
    <i class="fas fa-plus"></i> New Blog Post
  </a>
</div>

<div class="card">
  <div class="card-header"><i class="fas fa-list"></i> All Blog Posts</div>
  <div class="card-body">
    {% if posts and posts.items %}
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Title</th>
            <th>Category</th>
            <th>Author</th>
            <th>Views</th>
            <th>Status</th>
            <th>Published</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for post in posts.items %}
          <tr>
            <td>
              <strong>{{ post.title }}</strong>
              {% if post.is_featured %}
              <span class="badge bg-warning text-dark">
                <i class="fas fa-star"></i> Featured
              </span>
              {% endif %}
            </td>
            <td>
              {% if post.category %}
              <span class="badge bg-info">{{ post.category.name }}</span>
              {% else %}
              <span class="text-muted">Uncategorized</span>
              {% endif %}
            </td>
            <td>{{ post.author }}</td>
            <td><i class="fas fa-eye"></i> {{ post.views }}</td>
            <td>
              <span
                class="badge bg-{{ 'success' if post.is_published else 'secondary' }}"
              >
                {{ 'Published' if post.is_published else 'Draft' }}
              </span>
            </td>
            <td>
              {% if post.published_at %} {{ post.published_at|datetime('%b %d,
              %Y') }} {% else %}
              <span class="text-muted">Not published</span>
              {% endif %}
            </td>
            <td class="table-actions">
              <a
                href="{{ url_for('admin_edit_blog', id=post.id) }}"
                class="btn btn-sm btn-primary"
                title="Edit"
              >
                <i class="fas fa-edit"></i>
              </a>
              {% if post.is_published %}
              <a
                href="{{ url_for('blog_detail', slug=post.slug) }}"
                class="btn btn-sm btn-info"
                target="_blank"
                title="View"
              >
                <i class="fas fa-eye"></i>
              </a>
              {% endif %}
              <form
                method="POST"
                action="{{ url_for('admin_delete_blog', id=post.id) }}"
                style="display: inline"
                onsubmit="return confirm('Are you sure you want to delete this post?');"
              >
                <button
                  type="submit"
                  class="btn btn-sm btn-danger"
                  title="Delete"
                >
                  <i class="fas fa-trash"></i>
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    {% if posts.pages > 1 %}
    <nav aria-label="Blog pagination">
      <ul class="pagination justify-content-center">
        {% if posts.has_prev %}
        <li class="page-item">
          <a
            class="page-link"
            href="{{ url_for('admin_manage_blog', page=posts.prev_num) }}"
          >
            Previous
          </a>
        </li>
        {% endif %} {% for page_num in posts.iter_pages(left_edge=1,
        right_edge=1, left_current=1, right_current=2) %} {% if page_num %}
        <li class="page-item {{ 'active' if page_num == posts.page else '' }}">
          <a
            class="page-link"
            href="{{ url_for('admin_manage_blog', page=page_num) }}"
          >
            {{ page_num }}
          </a>
        </li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">...</span></li>
        {% endif %} {% endfor %} {% if posts.has_next %}
        <li class="page-item">
          <a
            class="page-link"
            href="{{ url_for('admin_manage_blog', page=posts.next_num) }}"
          >
            Next
          </a>
        </li>
        {% endif %}
      </ul>
    </nav>
    {% endif %} {% else %}
    <div class="text-center py-5">
      <i class="fas fa-blog fa-3x text-muted mb-3"></i>
      <h5 class="text-muted">No blog posts yet</h5>
      <p class="text-muted">Start by creating your first blog post</p>
      <a href="{{ url_for('admin_edit_blog') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Create First Post
      </a>
    </div>
    {% endif %}
  </div>
</div>

<!-- Categories Info -->
<div class="card mt-4">
  <div class="card-header"><i class="fas fa-tags"></i> Blog Categories</div>
  <div class="card-body">
    {% if categories %}
    <div class="row">
      {% for category in categories %}
      <div class="col-md-3 mb-2">
        <span class="badge bg-info me-1">{{ category.name }}</span>
        <small class="text-muted">({{ category.posts|length }} posts)</small>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p class="text-muted">No categories available</p>
    {% endif %}
  </div>
</div>
{% endblock %}
